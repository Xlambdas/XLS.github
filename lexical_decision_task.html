<!DOCTYPE html>
<html lang="fr">
  <body style="font-size: 48px; text-align: center; margin-top: 100px;">
    <div id="stimulus">
      <h1>Lexical Decision Task - Démo</h1>
      <p>Basé sur l'article de Lize Van der Linden et al. (2018)</p>
      <p>Lorsque vous connaissez le mot, appuyez sur la touche "t". Sinon, appuyez sur "f".</p>

      <p>Lorsque vous êtes prêt, appuyez sur la barre ESPACE pour commencer.</p>
    </div>

    <script>
      const fixationDuration = 500;
      let waitingStart = true;
      let index = 0;
      let startTime = 0;
      let experimentFinished = false;
      let results = [];

      const trials = [
        { word: "SURMODE", isWord: false },
        { word: "CITRON", isWord: true },
        { word: "GNUT", isWord: false },
        { word: "GEGALOP", isWord: false },
        { word: "FOREGO", isWord: true },
        { word: "HORAIRE", isWord: true },
        { word: "PREVÔTAL", isWord: true },
        { word: "BIERRA", isWord: false },
        { word: "BOUGNOUL", isWord: true },
        { word: "JARDAFEU", isWord: false },
        { word: "BLISS", isWord: true },
        { word: "OLDE", isWord: false },
        { word: "AQUARIUM", isWord: true },
        { word: "FRAPTURE", isWord: false },
        { word: "FANFARE", isWord: true }
      ];

      function runTrial() {
        if (index >= trials.length) {
          experimentFinished = true;
          stimulus.innerHTML = "Fin de la démo<br><span style='font-size:32px'>Appuie sur ESPACE pour afficher les résultats</span>";
          return;
        }

        // Étape 1 : afficher la croix
        setTimeout(() => {
          stimulus.innerHTML = "";
        }, fixationDuration);
        stimulus.innerHTML = "+";

        // Étape 2 : après 500 ms, afficher le stimulus
        setTimeout(() => {
            stimulus.innerHTML = trials[index].word;
            startTime = performance.now();
        }, fixationDuration);
      }

      function showResults() {
        let html = `
          <table border="1" style="margin: 40px auto; font-size: 24px; border-collapse: collapse;">
            <tr>
              <th>Stimulus</th>
              <th>Réponse</th>
              <th>Correct ?</th>
              <th>Temps (ms)</th>
            </tr>
        `;

        for (let r of results) {
          html += `
            <tr>
              <td>${r.stimulus}</td>
              <td>${r.response}</td>
              <td>${r.correct ? "true" : "false"}</td>
              <td>${r.rt}</td>
            </tr>
          `;
        }

        html += "</table>";

        resultsDiv.innerHTML = html;
      }

      document.addEventListener("keydown", (e) => {
        if (waitingStart && e.code === "Space") {
          waitingStart = false;
          runTrial();
          return;
        }

        if (waitingStart) return;

        if (experimentFinished && e.code === "Space") {
          showResults();
          return;
        }

        if (e.key !== "f" && e.key !== "t") return;

        const rt = Math.round(performance.now() - startTime);
        const response = (e.key === "f")? "mot" : "non-mot";

        results.push({
          stimulus: trials[index].word,
          response: response,
          correct: (response === "mot") === trials[index].isWord,
          rt: rt
        });

        index++;
        runTrial();
      });
    </script>
  </body>
</html>
